<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Results — {{ query }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
</head>

<body>
  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="container">
      <div class="nav-brand">
        <i class="fas fa-shopping-bag"></i>
        <span class="brand-name">Affordo</span>
      </div>
      <div>
        <a href="/" class="btn btn-link">New Search</a>
      </div>
    </div>
  </nav>

  <section class="comparison-section container">

    <!-- QUERY HEADING -->
    <h2>Results for: <em>{{ query }}</em></h2>

    <!-- BEST DEAL -->
    <p style="margin-top:8px;">
      Best deal:
      {% if best %}
        <span class="best-deal">{{ best.platform }} — ₹{{ best.price_numeric|int }}</span>
      {% else %}
        <span>Not available</span>
      {% endif %}
    </p>

    <!-- ⚠ PRICE MISSING NOTICE (OPTION 2) -->

    <!-- PLATFORM CARDS -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;margin-top:30px;">
      {% for platform, data in results.items() %}
        <div class="comparison-result" style="padding:18px;">
          
          <h3 style="margin:0 0 8px 0;">{{ platform }}</h3>

          {% if data.error %}
            <p style="color:#c0392b;">Error: {{ data.error }}</p>
          {% else %}

            <p style="margin:6px 0;">
              <strong>Product:</strong> {{ data.title or '—' }}
            </p>

            <p style="margin:6px 0;">
              <strong>Price:</strong>
              {% if data.price_numeric %}
                ₹{{ data.price_numeric|int }}
              {% else %}
                {{ data.price_raw or '—' }}
              {% endif %}
            </p>

            <p style="margin:6px 0;">
              {% if data.product_link %}
                <a class="btn btn-link" href="{{ data.product_link }}" target="_blank" rel="noopener">
                  View on {{ platform }}
                </a>
              {% endif %}
            </p>

            {% if best and platform == best.platform %}
              <div class="price-item" style="margin-top:8px;">
                <span class="best-deal">BEST DEAL</span>
              </div>
            {% endif %}

          {% endif %}

        </div>
      {% endfor %}
    </div>

  </section>
   {% if not results["Amazon"]["price_numeric"] or not results["Flipkart"]["price_numeric"] %}
      <p style="text-align:center; margin-top:15px; color:#555; font-size:0.95rem;">
        *The platforms might not show the price of the product if<br>
        They are <strong>new launches</strong> or  
        <strong>products not availabe currently!</strong>.
      </p>
    {% endif %}

  <script src="{{ url_for('static', filename='script.js') }}"></script>

</body>
</html>
